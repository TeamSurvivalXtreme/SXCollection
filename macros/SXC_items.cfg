#define SXC_ITEM_EVENT
  [event]
    name=moveto
    first_time_only=no
    [filter]
      [filter_side]
        team_name=Heroes
      [/filter_side]
      canrecruit=yes
    [/filter]
    {VARIABLE item_found no}
    {VARIABLE item_index -1}
    {FOREACH item i}
      [if]
        {SXC_CMP item[$i|].x numerical_equals $x1}
        {SXC_CMP item[$i|].y numerical_equals $y1}
        {SXC_CMP item[$i|].used numerical_equals 0}
        [then]
          [if]
            {SXC_CMP item[$i|].type contains "CHEST_GOLD"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=chest_gold_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "DEFRING"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=defring_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "RESRING"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=resring_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "BLUE_POTION"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=blue_potion_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "CYAN_POTION"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=cyan_potion_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "RED_POTION"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=red_potion_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "YELLOW_POTION"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=yellow_potion_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "TARGET"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=target_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "CORNUCOPIA"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=cornucopia_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "SCEPTRE"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=sceptre_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "SWORD"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=sword_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "BOW"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=bow_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "NECKLACE"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=necklace_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "ICEARMOR"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=icearmor_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "FIREARMOR"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=firearmor_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "SPIRITSTAFF"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=spiritstaff_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "BUCKLER"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=buckler_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "BARREL"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=barrel_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "DWARFPLATE"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=dwarfplate_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "RINGDARKNESS"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=ringdarkness_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
          [if]
            {SXC_CMP item[$i|].type equals "CLOAK"}
            [then]
              {VARIABLE item_found yes}
              {VARIABLE item_index $i}
              [fire_event]
                name=cloak_found
                [primary_unit]
                  x,y=$x1,$y1
                [/primary_unit]
              [/fire_event]
            [/then]
          [/if]
        [/then]
      [/if]
    {NEXT i}
    [if]
      {SXC_CMP item_found equals no}
      [then]
        [allow_undo]
        [/allow_undo]
      [/then]
    [/if]
    {CLEAR_VARIABLE item_found}
    {CLEAR_VARIABLE item_index}
  [/event]

  {SXC_CHEST_GOLD_EVENT}
  {SXC_DEFRING_EVENT}
  {SXC_RESRING_EVENT}
  {SXC_POTION_EVENTS}
  {SXC_BLUE_POTION_EVENT}
  {SXC_CYAN_POTION_EVENT}
  {SXC_RED_POTION_EVENT}
  {SXC_YELLOW_POTION_EVENT}
  {SXC_TARGET_EVENT}
  {SXC_CLOAK_EVENT}
  {SXC_CORNUCOPIA_EVENT}
  {SXC_SCEPTRE_EVENT}
  {SXC_SWORD_EVENT}
  {SXC_BOW_EVENT}
  {SXC_NECKLACE_EVENT}
  {SXC_ICEARMOR_EVENT}
  {SXC_FIREARMOR_EVENT}
  {SXC_SPIRITSTAFF_EVENT}
  {SXC_BUCKLER_EVENT}
  {SXC_BARREL_EVENT}
  {SXC_DWARFPLATE_EVENT}
  {SXC_RINGDARKNESS_EVENT}
#enddef

#define SXC_RESRING X Y
  {SXC_ITEM {X} {Y} "RESRING" "items/ring-white.png" ""}
#enddef

#define SXC_RESRING_EVENT
  [event]
    name=resring_found
    first_time_only=no
    [message]
      image=items/ring-white.png
      speaker=narrator
      message="You found a glowing little ring...
This magical ring can increase your resistances by 10%
You can have maximum of 2 silver rings at a time.
Currently you have $resring_$side_number||"
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        [show_if]
          {SXC_CMP resring_$side_number less_than 2}
          {SXC_CMP maximum_level_reached_$side_number equals "yes"}
        [/show_if]
        message="Take and use silver ring of resistance"
        [command]
          [sound]
            name=magic-holy-1.ogg
          [/sound]
          [print]
            text="Player $side_number| found silver ring of resistance."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            silent=yes
            duration=forever
            [effect]
              apply_to=resistance
              replace=no
              [resistance]
                arcane=-10
                blade=-10
                cold=-10
                fire=-10
                impact=-10
                pierce=-10
              [/resistance]
            [/effect]
          [/object]
          {VARIABLE_OP arcane_boost_$side_number add 10}
          {VARIABLE_OP blade_boost_$side_number add 10}
          {VARIABLE_OP cold_boost_$side_number add 10}
          {VARIABLE_OP fire_boost_$side_number add 10}
          {VARIABLE_OP impact_boost_$side_number add 10}
          {VARIABLE_OP pierce_boost_$side_number add 10}
          {VARIABLE_OP resring_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DROP_RESRING
  [option]
    message={MENU_IMG_TXT "icons/ring-white.png" "Drop silver ring of resistance (you have $resring_$side_number||)"}
    [show_if]
      {SXC_CMP resring_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_RESRING $x1 $y1}
      [print]
        text="Player $side_number| dropped silver ring of resistance."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [object]
        silent=yes
        duration=forever
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            arcane=10
            blade=10
            cold=10
            fire=10
            impact=10
            pierce=10
          [/resistance]
        [/effect]
      [/object]
      {VARIABLE_OP arcane_boost_$side_number sub 10}
      {VARIABLE_OP blade_boost_$side_number sub 10}
      {VARIABLE_OP cold_boost_$side_number sub 10}
      {VARIABLE_OP fire_boost_$side_number sub 10}
      {VARIABLE_OP impact_boost_$side_number sub 10}
      {VARIABLE_OP pierce_boost_$side_number sub 10}
      {VARIABLE_OP resring_$side_number sub 1}
    [/command]
  [/option]
#enddef

#define SXC_POTION_EVENTS
  [event]
    name=sxc_drink_potion_blue
    first_time_only=no
    [sound]
      name=heal.wav
    [/sound]
    [object]
      duration=forever
      [effect]
        apply_to=hitpoints
        increase=150
        violate_maximum=yes
      [/effect]
      silent=yes
      [effect]
        apply_to=status
        remove=poisoned
      [/effect]
      [effect]
        apply_to=status
        remove=slowed
      [/effect]
      silent=yes
    [/object]
    [store_unit]
      [filter]
        x=$x1
        y=$y1
      [/filter]
      variable=drinker
    [/store_unit]
    {VARIABLE_OP drinker.moves add 5}
    {VARIABLE drinker.attacks_left 1}
    [unstore_unit]
      variable=drinker
    [/unstore_unit]
    {CLEAR_VARIABLE drinker}
  [/event]

  [event]
    name=sxc_drink_potion_cyan
    first_time_only=no
    [sound]
      name=heal.wav
    [/sound]
    [object]
      [effect]
        apply_to=status
        remove=slowed
      [/effect]
      silent=yes
      duration=forever
    [/object]
    [store_unit]
      [filter]
        x=$x1
        y=$y1
      [/filter]
      variable=drinker
    [/store_unit]
    {VARIABLE_OP drinker.moves add 9}
    [unstore_unit]
      variable=drinker
    [/unstore_unit]
    {CLEAR_VARIABLE drinker}
  [/event]

  [event]
    name=sxc_drink_potion_yellow
    first_time_only=no
    [sound]
      name=heal.wav
    [/sound]
    [object]
      [effect]
        apply_to=status
        remove=poisoned
      [/effect]
      [effect]
        apply_to=status
        remove=slowed
      [/effect]
      [effect]
        apply_to=hitpoints
        increase_total=20
        violate_maximum=yes
      [/effect]
      [effect]
        apply_to=hitpoints
        heal_full=yes
        violate_maximum=yes
      [/effect]
      [effect]
        apply_to=hitpoints
        increase=100%
        violate_maximum=yes
      [/effect]
      silent=yes
      duration=forever
    [/object]
  [/event]

  [event]
    name=sxc_drink_potion_red
    first_time_only=no
    [sound]
      name=heal.wav
    [/sound]
    [object]
      duration=forever
      [effect]
        apply_to=status
        remove=poisoned
      [/effect]
      [effect]
        apply_to=status
        remove=slowed
      [/effect]
      [effect]
        apply_to=hitpoints
        heal_full=yes
        violate_maximum=yes
      [/effect]
      silent=yes
    [/object]
  [/event]
#enddef

#define SXC_YELLOW_POTION X Y
  {SXC_ITEM {X} {Y} "YELLOW_POTION" "items/potion-yellow.png" ""}
#enddef

#define SXC_YELLOW_POTION_EVENT
  [event]
    name=yellow_potion_found
    first_time_only=no
    [message]
      image=items/potion-yellow.png
      speaker=narrator
      message="You found a strange yellow potion. Drinking it will make you feel more healthy.
Your max. HP will be increased by 20 and your current HP will be doubled!
You can carry maximum of 4 potions of different types and 2 potions of same
type at a time. Currently you are carrying:
Yellow potions: $yellow_potions_$side_number||
Total number: $potions_total_$side_number||
For using one of yellow potions, that you are carrying, right-click on your
hero, select View inventory... and then select 'Drink yellow potion'."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        message="Take and use yellow potion"
        [command]
          [print]
            text="Player $side_number| found and used yellow potion."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [fire_event]
            name=sxc_drink_potion_yellow
            [primary_unit]
              x,y=$x1,$y1
            [/primary_unit]
          [/fire_event]
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
      [option]
        message="Take yellow potion for later use"
        [show_if]
          {SXC_CMP potions_total_$side_number less_than 4}
          {SXC_CMP yellow_potions_$side_number less_than 2}
        [/show_if]
        [command]
          [sound]
            name=fanfare-short.wav
          [/sound]
          [print]
            text="Player $side_number| found yellow potion."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          {VARIABLE_OP yellow_potions_$side_number add 1}
          {VARIABLE_OP potions_total_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DRINK_YELLOW_POTION
  [option]
    message={MENU_IMG_TXT "icons/potion-yellow_icon.png" "Drink yellow potion (+20HP max., full heal, 2xHP)"}
    [show_if]
      {SXC_CMP yellow_potions_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      [store_unit]
        [filter]
          x,y=$x1,$y1
          side=$side_number
        [/filter]
        variable=drinker
      [/store_unit]
      [if]
        {SXC_CMP drinker.attacks_left greater_than_equal_to 1}
        [then]
          {VARIABLE_OP yellow_potions_$side_number sub 1}
          {VARIABLE_OP potions_total_$side_number sub 1}
          [print]
            text="Player $side_number| used yellow potion."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [fire_event]
            name=sxc_drink_potion_yellow
            [primary_unit]
              x,y=$x1,$y1
            [/primary_unit]
          [/fire_event]
        [/then]
      [/if]
      {CLEAR_VARIABLE drinker}
    [/command]
  [/option]
#enddef

#define SXC_DROP_YELLOW_POTION
  [option]
    message={MENU_IMG_TXT "icons/potion-yellow_icon.png" "Drop yellow potion (you have $yellow_potions_$side_number||)"}
    [show_if]
      {SXC_CMP yellow_potions_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_YELLOW_POTION $x1 $y1}
      [print]
        text="Player $side_number| dropped yellow potion."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      {VARIABLE_OP yellow_potions_$side_number sub 1}
      {VARIABLE_OP potions_total_$side_number sub 1}
    [/command]
  [/option]
#enddef

#define SXC_RED_POTION X Y
  {SXC_ITEM {X} {Y} "RED_POTION" "items/potion-red.png" ""}
#enddef

#define SXC_RED_POTION_EVENT
  [event]
    name=red_potion_found
    first_time_only=no
    [message]
      image=items/potion-red.png
      speaker=narrator
      message="You found a strange red potion. Drinking it will heal all your wounds. Use it
wisely. You can carry maximum of 4 potions of different types and 2 potions
of same type at a time. Currently you are carrying:
Red potions: $red_potions_$side_number||
Total number: $potions_total_$side_number||
For using one of red potions, that you are carrying, right-click on your
hero, select View inventory... and then select 'Drink red potion'."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        message="Take and use red potion"
        [command]
          [print]
            text="Player $side_number| found and used red potion."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [fire_event]
            name=sxc_drink_potion_red
            [primary_unit]
              x,y=$x1,$y1
            [/primary_unit]
          [/fire_event]
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
      [option]
        message="Take red potion for later use"
        [show_if]
          {SXC_CMP potions_total_$side_number less_than 4}
          {SXC_CMP red_potions_$side_number less_than 2}
        [/show_if]
        [command]
          [sound]
            name=fanfare-short.wav
          [/sound]
          [print]
            text="Player $side_number| found red potion."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          {VARIABLE_OP red_potions_$side_number add 1}
          {VARIABLE_OP potions_total_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DRINK_RED_POTION
  [option]
    message={MENU_IMG_TXT "icons/potion-red_icon.png" "Drink red potion (Full heal)"}
    [show_if]
      {SXC_CMP red_potions_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      [store_unit]
        [filter]
          x,y=$x1,$y1
          side=$side_number
        [/filter]
        variable=drinker
      [/store_unit]
      [if]
        {SXC_CMP drinker.attacks_left greater_than_equal_to 1}
        [then]
          {VARIABLE_OP red_potions_$side_number sub 1}
          {VARIABLE_OP potions_total_$side_number sub 1}
          [print]
            text="Player $side_number| used red potion."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [fire_event]
            name=sxc_drink_potion_red
            [primary_unit]
              x,y=$x1,$y1
            [/primary_unit]
          [/fire_event]
        [/then]
      [/if]
      {CLEAR_VARIABLE drinker}
    [/command]
  [/option]
#enddef

#define SXC_DROP_RED_POTION
  [option]
    message={MENU_IMG_TXT "icons/potion-red_icon.png" "Drop red potion (you have $red_potions_$side_number||}"}
    [show_if]
      {SXC_CMP red_potions_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_RED_POTION $x1 $y1}
      [print]
        text="Player $side_number| dropped red potion."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      {VARIABLE_OP red_potions_$side_number sub 1}
      {VARIABLE_OP potions_total_$side_number sub 1}
    [/command]
  [/option]
#enddef

#define SXC_BLUE_POTION X Y
  {SXC_ITEM {X} {Y} "BLUE_POTION" "items/potion-blue.png" ""}
#enddef

#define SXC_BLUE_POTION_EVENT
  [event]
    name=blue_potion_found
    first_time_only=no
    [message]
      image=items/potion-blue.png
      speaker=narrator
      message="You found a strange blue potion. Drinking it will give you 5 additional
movement points reseting attack status so you can attack again and will grant
you as well 150 Hitpoints, even beyond maximum. Best use it while you have
low HP left and after you attacked first else the extra attack will be wasted.
You can carry maximum of 4 potions of different types and 2 potions of same
type at a time. Currently you are carrying:
Blue potions: $blue_potions_$side_number||
Total number: $potions_total_$side_number||
For using one of blue potions, that you are carrying, right-click on your
hero, select View inventory... and then select 'Drink blue potion'."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        message="Take and use blue potion"
        [command]
          [print]
            text="Player $side_number| found and used blue potion."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [fire_event]
            name=sxc_drink_potion_blue
            [primary_unit]
              x,y=$x1,$y1
            [/primary_unit]
          [/fire_event]
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
      [option]
        message="Take blue potion for later use"
        [show_if]
          {SXC_CMP potions_total_$side_number less_than 4}
          {SXC_CMP blue_potions_$side_number less_than 2}
        [/show_if]
        [command]
          [sound]
            name=fanfare-short.wav
          [/sound]
          [print]
            text="Player $side_number| found blue potion."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          {VARIABLE_OP blue_potions_$side_number add 1}
          {VARIABLE_OP potions_total_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DRINK_BLUE_POTION
  [option]
    message={MENU_IMG_TXT "icons/potion-blue_icon.png" "Drink blue potion (+5MP, extra attack, +150HP)"}
    [show_if]
      {SXC_CMP blue_potions_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {VARIABLE_OP blue_potions_$side_number sub 1}
      {VARIABLE_OP potions_total_$side_number sub 1}
      [print]
        text="Player $side_number| used blue potion."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [fire_event]
        name=sxc_drink_potion_blue
        [primary_unit]
          x,y=$x1,$y1
        [/primary_unit]
      [/fire_event]
    [/command]
  [/option]
#enddef

#define SXC_DROP_BLUE_POTION
  [option]
    message={MENU_IMG_TXT "icons/potion-blue_icon.png" "Drop blue potion (you have $blue_potions_$side_number||}"}
    [show_if]
      {SXC_CMP blue_potions_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_BLUE_POTION $x1 $y1}
      [print]
        text="Player $side_number| dropped blue potion."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      {VARIABLE_OP blue_potions_$side_number sub 1}
      {VARIABLE_OP potions_total_$side_number sub 1}
    [/command]
  [/option]
#enddef

#define SXC_CYAN_POTION X Y
  {SXC_ITEM {X} {Y} "CYAN_POTION" "items/potion-cyan.png" ""}
#enddef

#define SXC_CYAN_POTION_EVENT
  [event]
    name=cyan_potion_found
    first_time_only=no
    [message]
      image=items/potion-cyan.png
      speaker=narrator
      message="You found a strange cyan potion. Drinking it will give you temporarily
9 additional movement points even beyound your maximum movement.
You can carry maximum of 4 potions of different types and 2 potions of same
type at a time. Currently you are carrying:
Cyan potions: $cyan_potions_$side_number||
Total number: $potions_total_$side_number||
For using one of cyan potions, that you are carrying, right-click on your
hero, select View inventory... and then select 'Drink cyan potion'."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        message="Take and use cyan potion"
        [command]
          [print]
            text="Player $side_number| found and used cyan potion."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [fire_event]
            name=sxc_drink_potion_cyan
            [primary_unit]
              x,y=$x1,$y1
            [/primary_unit]
          [/fire_event]
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
      [option]
        message="Take cyan potion for later use"
        [show_if]
          {SXC_CMP potions_total_$side_number less_than 4}
          {SXC_CMP cyan_potions_$side_number less_than 2}
        [/show_if]
        [command]
          [sound]
            name=fanfare-short.wav
          [/sound]
          [print]
            text="Player $side_number| found cyan potion."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          {VARIABLE_OP cyan_potions_$side_number add 1}
          {VARIABLE_OP potions_total_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DRINK_CYAN_POTION
  [option]
    message={MENU_IMG_TXT "icons/potion-cyan_icon.png" "Drink cyan potion (+9MP, unslow)"}
    [show_if]
      {SXC_CMP cyan_potions_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {VARIABLE_OP cyan_potions_$side_number sub 1}
      {VARIABLE_OP potions_total_$side_number sub 1}
      [print]
        text="Player $side_number| used cyan potion."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [fire_event]
        name=sxc_drink_potion_cyan
        [primary_unit]
          x,y=$x1,$y1
        [/primary_unit]
      [/fire_event]
    [/command]
  [/option]
#enddef

#define SXC_DROP_CYAN_POTION
  [option]
    message={MENU_IMG_TXT "icons/potion-cyan_icon.png" "Drop cyan potion (you have $cyan_potions_$side_number||}"}
    [show_if]
      {SXC_CMP cyan_potions_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_CYAN_POTION $x1 $y1}
      [print]
        text="Player $side_number| dropped cyan potion."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      {VARIABLE_OP cyan_potions_$side_number sub 1}
      {VARIABLE_OP potions_total_$side_number sub 1}
    [/command]
  [/option]
#enddef

#define SXC_CHEST_GOLD X Y AMOUNT
  {SXC_ITEM {X} {Y} "CHEST_GOLD,{AMOUNT}" "items/chest-plain-closed.png" ""}
#enddef

#define SXC_CHEST_GOLD_EVENT
  [event]
    name=chest_gold_found
    first_time_only=no
    [set_variables]
      [split]
        list=$item[$item_index|].type
        key=amount
        separator=,
      [/split]
      name=chest
    [/set_variables]
    {VARIABLE divider 0}
    {VARIABLE j 1}
    [while]
      {SXC_CMP j less_than_equal_to 5}
      [do]
        [if]
          [have_unit]
            side=$j
            canrecruit=yes
          [/have_unit]
          [then]
            {VARIABLE_OP divider add 1}
          [/then]
        [/if]
        {VARIABLE_OP j add 1}
      [/do]
    [/while]
    [if]
      {SXC_CMP divider numerical_equals 1}
      [then]
        [print]
          text="This chest contains $chest[1].amount| gold!
   Player $side_number gained $share_gold gold."
          size=18
          duration=500
          red,green,blue=255,255,0
        [/print]
        {VARIABLE remainder $chest[1].amount}
      [/then]
      [else]
        {VARIABLE share_gold $chest[1].amount}
        {VARIABLE remainder $chest[1].amount}
        {SXC_ROUND share_gold divide $divider floor}
        {VARIABLE_OP remainder modulo $divider}
        [if]
          {SXC_CMP remainder numerical_not_equals 0}
          [then]
            {VARIABLE remainder_text "
Remaining $remainder gold gained player $side_number"}
          [/then]
        [/if]
        [print]
          text="   This chest contains $chest[1].amount gold!
   Every player gained $share_gold gold.$remainder_text"
          size=18
          duration=500
          red,green,blue=255,255,0
        [/print]
        {VARIABLE_OP remainder add $share_gold}
      [/else]
    [/if]
    {VARIABLE j 1}
    [while]
      {SXC_CMP j less_than_equal_to 5}
      [do]
        [if]
          [have_unit]
            side=$j
            canrecruit=yes
          [/have_unit]
          [then]
            [store_unit]
              [filter]
                side=$j
                canrecruit=yes
              [/filter]
              variable=chest_leader
            [/store_unit]
            [if]
              {SXC_CMP j numerical_equals $side_number}
              [then]
                [gold]
                  side=$j
                  amount=$remainder
                [/gold]
                [unstore_unit]
                  variable=chest_leader
                  text=$remainder
                  red,green,blue=255,255,0
                [/unstore_unit]
                {VARIABLE_OP income_$j| add $remainder}
              [/then]
              [else]
                [gold]
                  side=$j
                  amount=$share_gold
                [/gold]
                [unstore_unit]
                  variable=chest_leader
                  text=$share_gold
                  red,green,blue=255,255,0
                [/unstore_unit]
                {VARIABLE_OP income_$j| add $share_gold}
              [/else]
            [/if]
            {CLEAR_VARIABLE chest_leader}
          [/then]
        [/if]
        {VARIABLE_OP j add 1}
      [/do]
    [/while]
    [sound]
      name=gold.ogg
    [/sound]
    {CLEAR_VARIABLE chest}
    {CLEAR_VARIABLE share_gold}
    {CLEAR_VARIABLE remainder}
    {CLEAR_VARIABLE remainder_text}
    {CLEAR_VARIABLE divider}
    {VARIABLE item[$item_index|].used 1}
    {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
    {CLEAR_VARIABLE j}
  [/event]
#enddef

#define SXC_DEFRING X Y
  {SXC_ITEM {X} {Y} "DEFRING" "items/ring-gold.png" ""}
#enddef

#define SXC_DEFRING_EVENT
  [event]
    name=defring_found
    first_time_only=no
    [message]
      image=items/ring-gold.png
      speaker=narrator
      message="You found a glowing little ring...
This magical ring can help you to avoid your enemies' attacks.
It increases owner's defenses for all terrains by 10%.
You can have maximum of 2 gold rings at a time.
Currently you have $defring_$side_number||"
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        [show_if]
          {SXC_CMP defring_$side_number less_than 2}
          {SXC_CMP maximum_level_reached_$side_number equals "yes"}
        [/show_if]
        message="Take and use gold ring of defense"
        [command]
          [sound]
            name=magic-holy-1.ogg
          [/sound]
          [print]
            text="Player $side_number| found gold ring of defense."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            silent=yes
            duration=forever
            [effect]
              apply_to=defense
              replace=no
              [defense]
                castle=-10
                cave=-10
                deep_water=-10
                flat=-10
                forest=-10
                frozen=-10
                fungus=-10
                hills=-10
                impassable=-10
                mountains=-10
                reef=-10
                sand=-10
                shallow_water=-10
                swamp_water=-10
                unwalkable=-10
                village=-10
              [/defense]
            [/effect]
          [/object]
          {VARIABLE_OP defense_boost_$side_number add 10}
          {VARIABLE_OP defring_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DROP_DEFRING
  [option]
    message={MENU_IMG_TXT "icons/ring-gold.png" "Drop gold ring of defense (you have $defring_$side_number||)"}
    [show_if]
      {SXC_CMP defring_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_DEFRING $x1 $y1}
      [print]
        text="Player $side_number| dropped gold ring of defense."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [object]
        silent=yes
        duration=forever
        [effect]
          apply_to=defense
          replace=no
          [defense]
            castle=10
            cave=10
            deep_water=10
            flat=10
            forest=10
            frozen=10
            fungus=10
            hills=10
            impassable=10
            mountains=10
            reef=10
            sand=10
            shallow_water=10
            swamp_water=10
            unwalkable=10
            village=10
          [/defense]
        [/effect]
      [/object]
      {VARIABLE_OP defring_$side_number sub 1}
      {VARIABLE_OP defense_boost_$side_number sub 10}
    [/command]
  [/option]
#enddef

#define SXC_TARGET X Y
  {SXC_ITEM {X} {Y} "TARGET" "items/archery-target-right.png" ""}
#enddef

#define SXC_TARGET_EVENT
  [event]
    name=target_found
    first_time_only=no
    [message]
      image=items/archery-target-right.png
      speaker=narrator
      message="You found the magical Diversion Creater! Its bearer receives a distracting aura, which grants a bonus of 20 percent to blade, impact, and pierce resistance."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        [show_if]
          {SXC_CMP target_$side_number less_than 1}
          {SXC_CMP maximum_level_reached_$side_number equals "yes"}
        [/show_if]
        message="Take and use Target"
        [command]
          [sound]
            name=magic-holy-1.ogg
          [/sound]
          [print]
            text="Player $side_number| found Target."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            silent=yes
            duration=forever
            [effect]
              apply_to=resistance
              replace=no
              [resistance]
                blade=-20
                impact=-20
                pierce=-20
              [/resistance]
            [/effect]
          [/object]
          {VARIABLE_OP blade_boost_$side_number add 20}
          {VARIABLE_OP impact_boost_$side_number add 20}
          {VARIABLE_OP pierce_boost_$side_number add 20}
          {VARIABLE_OP target_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DROP_TARGET
  [option]
    message={MENU_IMG_TXT "items/archery-target-right.png" "Drop Target (you have $target_$side_number||)"}
    [show_if]
      {SXC_CMP target_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_TARGET $x1 $y1}
      [print]
        text="Player $side_number| dropped the Target."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [object]
        silent=yes
        duration=forever
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=20
            impact=20
            pierce=20
          [/resistance]
        [/effect]
      [/object]
      {VARIABLE_OP blade_boost_$side_number sub 20}
      {VARIABLE_OP impact_boost_$side_number sub 20}
      {VARIABLE_OP pierce_boost_$side_number sub 20}
      {VARIABLE_OP target_$side_number add -1}
    [/command]
  [/option]
#enddef

#define SXC_NECKLACE X Y
  {SXC_ITEM {X} {Y} "NECKLACE" "items/ankh-necklace.png" ""}
#enddef

#define SXC_NECKLACE_EVENT
  [event]
    name=necklace_found
    first_time_only=no
    [message]
      image=items/ankh-necklace.png
      speaker=narrator
      message="You found the Silver Necklace of Protection. Its bearer receives a Circle of Protection, which grants a bonus of 20 percent to fire, cold and arcane resistance."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        [show_if]
          {SXC_CMP necklace_$side_number less_than 1}
          {SXC_CMP maximum_level_reached_$side_number equals "yes"}
        [/show_if]
        message="Take and use Necklace"
        [command]
          [sound]
            name=magic-holy-1.ogg
          [/sound]
          [print]
            text="Player $side_number| found Necklace."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            silent=yes
            duration=forever
            [effect]
              apply_to=resistance
              replace=no
              [resistance]
                fire=-20
                cold=-20
                arcane=-20
              [/resistance]
            [/effect]
          [/object]
          {VARIABLE_OP arcane_boost_$side_number add 20}
          {VARIABLE_OP cold_boost_$side_number add 20}
          {VARIABLE_OP fire_boost_$side_number add 20}
          {VARIABLE_OP necklace_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DROP_NECKLACE
  [option]
    message={MENU_IMG_TXT "items/ankh-necklace.png" "Drop Necklace (you have $necklace_$side_number||)"}
    [show_if]
      {SXC_CMP necklace_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_NECKLACE $x1 $y1}
      [print]
        text="Player $side_number| dropped the Necklace."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [object]
        silent=yes
        duration=forever
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            fire=20
            cold=20
            arcane=20
          [/resistance]
        [/effect]
      [/object]
      {VARIABLE_OP arcane_boost_$side_number sub 20}
      {VARIABLE_OP cold_boost_$side_number sub 20}
      {VARIABLE_OP fire_boost_$side_number sub 20}
      {VARIABLE_OP necklace_$side_number add -1}
    [/command]
  [/option]
#enddef

#define SXC_ICEARMOR X Y
  {SXC_ITEM {X} {Y} "ICEARMOR" "items/armor.png" ""}
#enddef

#define SXC_ICEARMOR_EVENT
  [event]
    name=icearmor_found
    first_time_only=no
    [message]
      image=items/armor.png
      speaker=narrator
      message="You found the legendary Ice Armor. Its bearer recieves a bonus of 20 percent to cold resistance."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        [show_if]
          {SXC_CMP icearmor_$side_number less_than 1}
          {SXC_CMP maximum_level_reached_$side_number equals "yes"}
        [/show_if]
        message="Take and use Ice Armor"
        [command]
          [sound]
            name=magic-holy-1.ogg
          [/sound]
          [print]
            text="Player $side_number| found Ice Armor."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            silent=yes
            duration=forever
            [effect]
              apply_to=resistance
              replace=no
              [resistance]
                cold=-20
              [/resistance]
            [/effect]
          [/object]
          {VARIABLE_OP cold_boost_$side_number add 20}
          {VARIABLE_OP icearmor_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DROP_ICEARMOR
  [option]
    message={MENU_IMG_TXT "items/armor.png" "Drop Ice Armor (you have $icearmor_$side_number||)"}
    [show_if]
      {SXC_CMP icearmor_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_ICEARMOR $x1 $y1}
      [print]
        text="Player $side_number| dropped the Ice Armor."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [object]
        silent=yes
        duration=forever
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            cold=20
          [/resistance]
        [/effect]
      [/object]
      {VARIABLE_OP cold_boost_$side_number sub 20}
      {VARIABLE_OP icearmor_$side_number add -1}
    [/command]
  [/option]
#enddef

#define SXC_FIREARMOR X Y
  {SXC_ITEM {X} {Y} "FIREARMOR" "items/armor-golden.png" ""}
#enddef

#define SXC_FIREARMOR_EVENT
  [event]
    name=firearmor_found
    first_time_only=no
    [message]
      image=items/armor-golden.png
      speaker=narrator
      message="You found the legendary FireArmor. Its bearer recieves a bonus of 20 percent to fire resistance."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        [show_if]
          {SXC_CMP firearmor_$side_number less_than 1}
          {SXC_CMP maximum_level_reached_$side_number equals "yes"}
        [/show_if]
        message="Take and use FireArmor"
        [command]
          [sound]
            name=magic-holy-1.ogg
          [/sound]
          [print]
            text="Player $side_number| found FireArmor."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            silent=yes
            duration=forever
            [effect]
              apply_to=resistance
              replace=no
              [resistance]
                fire=-20
              [/resistance]
            [/effect]
          [/object]
          {VARIABLE_OP fire_boost_$side_number add 20}
          {VARIABLE_OP firearmor_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DROP_FIREARMOR
  [option]
    message={MENU_IMG_TXT "items/armor-golden.png" "Drop FireArmor (you have $firearmor_$side_number||)"}
    [show_if]
      {SXC_CMP firearmor_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_FIREARMOR $x1 $y1}
      [print]
        text="Player $side_number| dropped the FireArmor."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [object]
        silent=yes
        duration=forever
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            fire=20
          [/resistance]
        [/effect]
      [/object]
      {VARIABLE_OP fire_boost_$side_number sub 20}
      {VARIABLE_OP firearmor_$side_number add -1}
    [/command]
  [/option]
#enddef

#define SXC_SPIRITSTAFF X Y
  {SXC_ITEM {X} {Y} "SPIRITSTAFF" "items/staff.png" ""}
#enddef

#define SXC_SPIRITSTAFF_EVENT
  [event]
    name=spiritstaff_found
    first_time_only=no
    [message]
      image=items/staff.png
      speaker=narrator
      message="You found the legendary SpiritStaff. Its bearer receives a bonus of 20 percent to arcane resistance."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        [show_if]
          {SXC_CMP spiritstaff_$side_number less_than 1}
          {SXC_CMP maximum_level_reached_$side_number equals "yes"}
        [/show_if]
        message="Take and use Spirit Staff"
        [command]
          [sound]
            name=magic-holy-1.ogg
          [/sound]
          [print]
            text="Player $side_number| found Spirit Staff."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            silent=yes
            duration=forever
            [effect]
              apply_to=resistance
              replace=no
              [resistance]
                arcane=-20
              [/resistance]
            [/effect]
          [/object]
          {VARIABLE_OP arcane_boost_$side_number add 20}
          {VARIABLE_OP spiritstaff_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DROP_SPIRITSTAFF
  [option]
    message={MENU_IMG_TXT "items/staff.png" "Drop Spirit Staff (you have $spiritstaff_$side_number||)"}
    [show_if]
      {SXC_CMP spiritstaff_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_SPIRITSTAFF $x1 $y1}
      [print]
        text="Player $side_number| dropped the Spirit Staff."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [object]
        silent=yes
        duration=forever
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            arcane=20
          [/resistance]
        [/effect]
      [/object]
      {VARIABLE_OP arcane_boost_$side_number sub 20}
      {VARIABLE_OP spiritstaff_$side_number add -1}
    [/command]
  [/option]
#enddef

#define SXC_BUCKLER X Y
  {SXC_ITEM {X} {Y} "BUCKLER" "items/buckler.png" ""}
#enddef

#define SXC_BUCKLER_EVENT
  [event]
    name=buckler_found
    first_time_only=no
    [message]
      image=items/buckler.png
      speaker=narrator
      message="You found the incredible Dragonbone Shield. Its bearer recieves a bonus of 20 percent to blade, impact and pierce resistances."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        [show_if]
          {SXC_CMP buckler_$side_number less_than 1}
          {SXC_CMP maximum_level_reached_$side_number equals "yes"}
        [/show_if]
        message="Take and use Dragonbone Shield"
        [command]
          [sound]
            name=magic-holy-1.ogg
          [/sound]
          [print]
            text="Player $side_number| found Dragonbone Shield."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            silent=yes
            duration=forever
            [effect]
              apply_to=resistance
              replace=no
              [resistance]
                blade=-20
                impact=-20
                pierce=-20
              [/resistance]
            [/effect]
          [/object]
          {VARIABLE_OP blade_boost_$side_number add 20}
          {VARIABLE_OP impact_boost_$side_number add 20}
          {VARIABLE_OP pierce_boost_$side_number add 20}
          {VARIABLE_OP buckler_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DROP_BUCKLER
  [option]
    message={MENU_IMG_TXT "items/buckler.png" "Drop Dragonbone Shield (you have $buckler_$side_number||)"}
    [show_if]
      {SXC_CMP buckler_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_BUCKLER $x1 $y1}
      [print]
        text="Player $side_number| dropped the Dragonbone Shield."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [object]
        silent=yes
        duration=forever
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=20
            impact=20
            pierce=20
          [/resistance]
        [/effect]
      [/object]
      {VARIABLE_OP blade_boost_$side_number sub 20}
      {VARIABLE_OP impact_boost_$side_number sub 20}
      {VARIABLE_OP pierce_boost_$side_number sub 20}
      {VARIABLE_OP buckler_$side_number add -1}
    [/command]
  [/option]
#enddef

#define SXC_BARREL X Y
  {SXC_ITEM {X} {Y} "BARREL" "items/barrel.png" ""}
#enddef

#define SXC_BARREL_EVENT
  [event]
    name=barrel_found
    first_time_only=no
    [message]
      image=items/barrel.png
      speaker=narrator
      message="You found the mythical Barrel of Power. Its bearer recieves a bonus of 20 percent to pierce resistance."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        [show_if]
          {SXC_CMP barrel_$side_number less_than 1}
          {SXC_CMP maximum_level_reached_$side_number equals "yes"}
        [/show_if]
        message="Take and use Barrel of Power"
        [command]
          [sound]
            name=magic-holy-1.ogg
          [/sound]
          [print]
            text="Player $side_number| found Barrel of Power."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            silent=yes
            duration=forever
            [effect]
              apply_to=resistance
              replace=no
              [resistance]
                pierce=-20
              [/resistance]
            [/effect]
          [/object]
          {VARIABLE_OP pierce_boost_$side_number add 20}
          {VARIABLE_OP barrel_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DROP_BARREL
  [option]
    message={MENU_IMG_TXT "items/barrel.png" "Drop Barrel of Power (you have $barrel_$side_number||)"}
    [show_if]
      {SXC_CMP barrel_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_BARREL $x1 $y1}
      [print]
        text="Player $side_number| dropped the Barrel of Power."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [object]
        silent=yes
        duration=forever
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            pierce=20
          [/resistance]
        [/effect]
      [/object]
      {VARIABLE_OP pierce_boost_$side_number sub 20}
      {VARIABLE_OP barrel_$side_number add -1}
    [/command]
  [/option]
#enddef

#define SXC_DWARFPLATE X Y
  {SXC_ITEM {X} {Y} "DWARFPLATE" "items/dummy.png" ""}
#enddef

#define SXC_DWARFPLATE_EVENT
  [event]
    name=dwarfplate_found
    first_time_only=no
    [message]
      image=items/dummy.png
      speaker=narrator
      message="You found the Dwarvish Plate. Its bearer recieves a bonus of 20 percent to impact resistance."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        [show_if]
          {SXC_CMP dwarvishplate_$side_number less_than 1}
          {SXC_CMP maximum_level_reached_$side_number equals "yes"}
        [/show_if]
        message="Take and use Dwarvish Plate"
        [command]
          [sound]
            name=magic-holy-1.ogg
          [/sound]
          [print]
            text="Player $side_number| found Dwarvish Plate."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            silent=yes
            duration=forever
            [effect]
              apply_to=resistance
              replace=no
              [resistance]
                impact=-20
              [/resistance]
            [/effect]
          [/object]
          {VARIABLE_OP impact_boost_$side_number add 20}
          {VARIABLE_OP dwarvishplate_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DROP_DWARFPLATE
  [option]
    message={MENU_IMG_TXT "items/dummy.png" "Drop Dwarvish Plate (you have $dwarvishplate_$side_number||)"}
    [show_if]
      {SXC_CMP dwarvishplate_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_DWARFPLATE $x1 $y1}
      [print]
        text="Player $side_number| dropped the Dwarvish Plate."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [object]
        silent=yes
        duration=forever
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            impact=20
          [/resistance]
        [/effect]
      [/object]
      {VARIABLE_OP impact_boost_$side_number sub 20}
      {VARIABLE_OP dwarvishplate_$side_number add -1}
    [/command]
  [/option]
#enddef

#define SXC_CORNUCOPIA X Y
  {SXC_ITEM {X} {Y} "CORNUCOPIA" "items/ornate2.png" ""}
#enddef

#define SXC_CORNUCOPIA_EVENT
  [event]
    name=cornucopia_found
    first_time_only=no
    [message]
      image=items/ornate2.png
      speaker=narrator
      message="You found the legendary Cornucopia of Fortune. Income from kills is raised by 20 percent (for all players)."
    [/message]
    [sound]
      name=magic-holy-1.ogg
    [/sound]
    [print]
      text="Player $side_number| found Cornucopia."
      size=18
      duration=500
      red,green,blue=255,255,0
    [/print]
    {VARIABLE cornucopia 1}
    {VARIABLE item[$item_index|].used 1}
    {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
  [/event]
#enddef

# The Cornucopia boosts all players' income, no matter who has it. Therefore it
# makes no sense to drop it for another player. The player-death event also
# ignores it.
#define SXC_TEAM_STAT_CORNUCOPIA
  [option]
    image="items/ornate2.png"
    label="The team has the Cornucopia, everyone gets 20% more income from kills"
    [show_if]
      {SXC_CMP cornucopia greater_than_equal_to 1}
    [/show_if]
    [command]
      # No action
    [/command]
  [/option]
#enddef

#define SXC_SCEPTRE X Y
  {SXC_ITEM {X} {Y} "SCEPTRE" "items/sceptre-of-fire.png" ""}
#enddef

#define SXC_SCEPTRE_EVENT
  [event]
    name=sceptre_found
    first_time_only=no
    [message]
      image=items/sceptre-of-fire.png
      speaker=narrator
      message="You found the Ancient Sceptre of Cantar. Your damage and damage of adjacent own and allied Units as well is increased by 25 Percent."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        [show_if]
          {SXC_CMP sceptre_$side_number less_than 1}
          {SXC_CMP maximum_level_reached_$side_number equals "yes"}
        [/show_if]
        message="Take and use Sceptre"
        [command]
          [sound]
            name=magic-holy-1.ogg
          [/sound]
          [print]
            text="Player $side_number| found Sceptre."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            silent=yes
            duration=forever
            [effect]
              apply_to=new_ability
              [abilities]
                [leadership]
                  id=sceptre_cantar
                  value=25
                  cumulative=no
                  name="sceptre of cantar"
                  description="The Ancient Sceptre of Cantar: Increases damage of self, adjacent own and allied units by 25 Percent. it is a non-cumulative leadership ability."
                  affect_self=yes
                  affect_allies=yes
                  affect_enemies=no
                  [affect_adjacent]
                    adjacent=n,ne,se,s,sw,nw
                  [/affect_adjacent]
                [/leadership]
              [/abilities]
            [/effect]
          [/object]
          {VARIABLE_OP sceptre_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DROP_SCEPTRE
  [option]
    message={MENU_IMG_TXT "items/sceptre-of-fire.png" "Drop Sceptre (you have $sceptre_$side_number||)"}
    [show_if]
      {SXC_CMP sceptre_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_SCEPTRE $x1 $y1}
      [print]
        text="Player $side_number| dropped the Sceptre."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [object]
        silent=yes
        duration=forever
        [effect]
          apply_to=remove_ability
          [abilities]
            [dummy]
              id=sceptre_cantar
            [/dummy]
          [/abilities]
        [/effect]
      [/object]
      {VARIABLE_OP sceptre_$side_number add -1}
    [/command]
  [/option]
#enddef

#define SXC_SWORD X Y
  {SXC_ITEM {X} {Y} "SWORD" "items/flame-sword.png" ""}
#enddef

#define SXC_SWORD_EVENT
  [event]
    name=sword_found
    first_time_only=no
    [message]
      image=items/flame-sword.png
      speaker=narrator
      message="You found the Holy Sword of the Crusader. Your damage and damage of adjacent own and allied Units as well is increased by 25 Percent."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        [show_if]
          {SXC_CMP sword_$side_number less_than 1}
          {SXC_CMP maximum_level_reached_$side_number equals "yes"}
        [/show_if]
        message="Take and use Sword"
        [command]
          [sound]
            name=magic-holy-1.ogg
          [/sound]
          [print]
            text="Player $side_number| found Sword."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            silent=yes
            duration=forever
            [effect]
              apply_to=new_ability
              [abilities]
                [leadership]
                  id=sword_crusader
                  value=25
                  cumulative=no
                  name="sword of the crusader"
                  description="The Holy Sword of the Crusader: Increases damage of self, adjacent own and allied units by 25 Percent. it is a non-cumulative leadership ability."
                  affect_self=yes
                  affect_allies=yes
                  affect_enemies=no
                  [affect_adjacent]
                    adjacent=n,ne,se,s,sw,nw
                  [/affect_adjacent]
                [/leadership]
              [/abilities]
            [/effect]
          [/object]
          {VARIABLE_OP sword_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DROP_SWORD
  [option]
    message={MENU_IMG_TXT "items/flame-sword.png" "Drop Sword (you have $sword_$side_number||)"}
    [show_if]
      {SXC_CMP sword_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_SWORD $x1 $y1}
      [print]
        text="Player $side_number| dropped the Sword."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [object]
        silent=yes
        duration=forever
        [effect]
          apply_to=remove_ability
          [abilities]
            [dummy]
              id=sword_crusader
            [/dummy]
          [/abilities]
        [/effect]
      [/object]
      {VARIABLE_OP sword_$side_number add -1}
    [/command]
  [/option]
#enddef

#define SXC_BOW X Y
  {SXC_ITEM {X} {Y} "BOW" "items/bow-elven.png" ""}
#enddef

#define SXC_BOW_EVENT
  [event]
    name=bow_found
    first_time_only=no
    [message]
      image=items/bow-elven.png
      speaker=narrator
      message="You found the Crystal Bow of the Hunter. Your damage and damage of adjacent own and allied Units as well is increased by 25 Percent."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        [show_if]
          {SXC_CMP bow_$side_number less_than 1}
          {SXC_CMP maximum_level_reached_$side_number equals "yes"}
        [/show_if]
        message="Take and use Bow"
        [command]
          [sound]
            name=magic-holy-1.ogg
          [/sound]
          [print]
            text="Player $side_number| found Bow."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            silent=yes
            duration=forever
            [effect]
              apply_to=new_ability
              [abilities]
                [leadership]
                  id=crystal_bow
                  value=25
                  cumulative=no
                  name="bow of the hunter"
                  description="Crystal Bow of the Hunter: Increases damage of self, adjacent own and allied units by 25 Percent. it is a non-cumulative leadership ability."
                  affect_self=yes
                  affect_allies=yes
                  affect_enemies=no
                  [affect_adjacent]
                    adjacent=n,ne,se,s,sw,nw
                  [/affect_adjacent]
                [/leadership]
              [/abilities]
            [/effect]
          [/object]
          {VARIABLE_OP bow_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DROP_BOW
  [option]
    message={MENU_IMG_TXT "items/bow-elven.png" "Drop Bow (you have $bow_$side_number||)"}
    [show_if]
      {SXC_CMP bow_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_BOW $x1 $y1}
      [print]
        text="Player $side_number| dropped the Bow."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [object]
        silent=yes
        duration=forever
        [effect]
          apply_to=remove_ability
          [abilities]
            [dummy]
              id=crystal_bow
            [/dummy]
          [/abilities]
        [/effect]
      [/object]
      {VARIABLE_OP bow_$side_number add -1}
    [/command]
  [/option]
#enddef

#define SXC_RINGDARKNESS X Y
  {SXC_ITEM {X} {Y} "RINGDARKNESS" "items/ring-red.png" ""}
#enddef

#define SXC_RINGDARKNESS_EVENT
  [event]
    name=ringdarkness_found
    first_time_only=no
    [message]
      image=items/ring-red.png
      speaker=narrator
      message="You found the Ring of Darkness. Every enemy unit within the dark aura that sourrounds its bearer will suffer -25 percent on their attacks."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        [show_if]
          {SXC_CMP ringofdarkness_$side_number less_than 1}
          {SXC_CMP maximum_level_reached_$side_number equals "yes"}
        [/show_if]
        message="Take and use Ring of Darkness"
        [command]
          [sound]
            name=magic-holy-1.ogg
          [/sound]
          [print]
            text="Player $side_number| found Ring of Darkness."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            silent=yes
            duration=forever
            [effect]
              apply_to=new_ability
              [abilities]
                [leadership]
                  id=ringdarkness
                  value=-25
                  cumulative=no
                  name="ring of darkness"
                  description="Ring of Darkness makes all adjacent enemy units fight worse (-25% for attack)."
                  affect_self=no
                  affect_allies=no
                  affect_enemies=yes
                  [affect_adjacent]
                    adjacent=n,ne,se,s,sw,nw
                  [/affect_adjacent]
                [/leadership]
              [/abilities]
            [/effect]
          [/object]
          {VARIABLE_OP ringofdarkness_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DROP_RINGDARKNESS
  [option]
    message={MENU_IMG_TXT "items/ring-red.png" "Drop Ring of Darkness (you have $ringofdarkness_$side_number||)"}
    [show_if]
      {SXC_CMP ringofdarkness_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_RINGDARKNESS $x1 $y1}
      [print]
        text="Player $side_number| dropped the Ring of Darkness."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [object]
        silent=yes
        duration=forever
        [effect]
          apply_to=remove_ability
          [abilities]
            [dummy]
              id=ringdarkness
            [/dummy]
          [/abilities]
        [/effect]
      [/object]
      {VARIABLE_OP ringofdarkness_$side_number add -1}
    [/command]
  [/option]
#enddef

# Fix all following items
#define SXC_CLOAK X Y
  {SXC_ITEM {X} {Y} "CLOAK" "items/cloak-green.png" ""}
#enddef

#define SXC_CLOAK_EVENT
  [event]
    name=cloak_found
    first_time_only=no
    [message]
      image=items/cloak-green.png
      speaker=narrator
      message="You found a Green Cloak... This magical Cloak will reduce your Movement Costs in every Category to 1. You feel as if you were flying."
      [option]
        message="I'll leave it for another player"
        [command]
        [/command]
      [/option]
      [option]
        [show_if]
          {SXC_CMP cloak_$side_number less_than 1}
          {SXC_CMP maximum_level_reached_$side_number equals "yes"}
        [/show_if]
        message="Take and use Cloak"
        [command]
          [store_unit]
            [filter]
              side=$side_number
              canrecruit=yes
            [/filter]
            variable=cloak_unit
          [/store_unit]
          [set_variables]
            name=cloak_saved_$side_number
            to_variable=cloak_unit.movement_costs
          [/set_variables]
          {CLEAR_VARIABLE cloak_unit}
          [sound]
            name=magic-holy-1.ogg
          [/sound]
          [print]
            text="Player $side_number| found Cloak."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            silent=yes
            duration=forever
            [effect]
              apply_to=movement_costs
              replace=yes
              [movement_costs]
                castle=1
                cave=1
                deep_water=1
                flat=1
                forest=1
                frozen=1
                fungus=1
                hills=1
                impassable=50
                mountains=1
                reef=1
                sand=1
                shallow_water=1
                swamp_water=1
                unwalkable=1
                village=1
              [/movement_costs]
            [/effect]
          [/object]
          {VARIABLE_OP cloak_$side_number add 1}
          {VARIABLE item[$item_index|].used 1}
          {SXC_REDRAW_ITEMS $item[$item_index|].x $item[$item_index|].y}
        [/command]
      [/option]
    [/message]
  [/event]
#enddef

#define SXC_DROP_CLOAK
  [option]
    message={MENU_IMG_TXT "items/cloak-green.png" "Drop Cloak (you have $cloak_$side_number||)"}
    [show_if]
      {SXC_CMP cloak_$side_number greater_than_equal_to 1}
    [/show_if]
    [command]
      {SXC_CLOAK $x1 $y1}
      [print]
        text="Player $side_number| dropped the Cloak."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [object]
        silent=yes
        duration=forever
        [effect]
          apply_to=movement_costs
          replace=yes
          [movement_costs]
            castle=$cloak_saved_$side_number|.castle
            cave=$cloak_saved_$side_number|.cave
            deep_water=$cloak_saved_$side_number|.deep_water
            flat=$cloak_saved_$side_number|.flat
            forest=$cloak_saved_$side_number|.forest
            frozen=$cloak_saved_$side_number|.frozen
            fungus=$cloak_saved_$side_number|.fungus
            hills=$cloak_saved_$side_number|.hills
            impassable=50
            mountains=$cloak_saved_$side_number|.mountains
            reef=$cloak_saved_$side_number|.reef
            sand=$cloak_saved_$side_number|.sand
            shallow_water=$cloak_saved_$side_number|.shallow_water
            swamp_water=$cloak_saved_$side_number|.swamp_water
            unwalkable=$cloak_saved_$side_number|.unwalkable
            village=$cloak_saved_$side_number|.village
          [/movement_costs]
        [/effect]
      [/object]
      {CLEAR_VARIABLE cloak_saved_$side_number}
      {VARIABLE_OP cloak_$side_number add -1}
    [/command]
  [/option]
#enddef
